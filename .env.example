# ==============================================
# Smart Accounting Platform - Environment Config
# ==============================================
# Copy this file to .env and update the values

# ==================
# Required Variables
# ==================

# Database connection URL (asyncpg for async operations)
# Format: postgresql+asyncpg://user:password@host:port/database
DATABASE_URL=postgresql+asyncpg://accounting_user:change_me_in_production@db:5432/accounting_db

# Sync database URL (for migrations and seed scripts)
# Format: postgresql://user:password@host:port/database
DATABASE_URL_SYNC=postgresql://accounting_user:change_me_in_production@db:5432/accounting_db

# Security key for JWT tokens and session encryption
# IMPORTANT: Generate a secure key with: openssl rand -hex 32
SECRET_KEY=change-me-use-openssl-rand-hex-32-for-production

# CORS origins (comma-separated list of allowed frontend origins)
# For local dev: http://localhost:3000,http://localhost:5173
# For production: https://your-frontend-domain.com (e.g., https://zzpershub.nl)
# ⚠️ IMPORTANT: Must use https:// scheme in production for CORS to work with TLS
CORS_ORIGINS=http://localhost:3000,http://localhost:5173,http://127.0.0.1:3000,http://127.0.0.1:5173

# Server port (default: 8000)
PORT=8000

# Environment (development, staging, production)
ENV=production

# ==================
# URL Configuration
# ==================

# Backend API URL (used in emails and internal references)
# For local dev: http://localhost:8000
# For production: https://api.yourdomain.com (e.g., https://api.zzpershub.nl)
APP_URL=http://localhost:8000

# Frontend URL (used in email links - verification, password reset)
# For local dev: http://localhost:5173
# For production: https://yourdomain.com (e.g., https://zzpershub.nl)
# ⚠️ IMPORTANT: This URL appears in verification/reset emails sent to users
FRONTEND_URL=http://localhost:5173

# ==================
# Email (Resend)
# ==================

# Resend API key for sending emails (required for email verification/password reset)
# Get your API key from https://resend.com
# RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxxxxxx

# From email address for transactional emails
# Must be verified in Resend dashboard
RESEND_FROM_EMAIL=no-reply@example.com

# Support email shown in email templates
SUPPORT_EMAIL=support@example.com

# ==================
# Optional Variables
# ==================

# Redis URL (optional - if not set, Redis features are disabled)
# Format: redis://host:port/db
# REDIS_URL=redis://redis:6379/0

# Debug mode (set to false in production)
DEBUG=false

# File upload directory
UPLOAD_DIR=/data/uploads

# Proxy Headers Security
# Which IP addresses are allowed to set X-Forwarded-* headers
# For Coolify/Traefik, restrict to Docker network (e.g., 172.17.0.0/16)
# Use '*' only if behind a trusted proxy that filters these headers
# FORWARDED_ALLOW_IPS=172.17.0.0/16

# ==================
# Admin Whitelist
# ==================
# Comma-separated list of email addresses allowed to have admin role
# Admin users can ONLY be created via database seed (not public registration)
# Example: admin@example.com,superadmin@company.com
# ADMIN_WHITELIST=admin@example.com

# ==================
# Admin User Seeding
# ==================
# Use these environment variables with the seed script to create an admin user
# Example: SEED_ADMIN_EMAIL=admin@example.com SEED_ADMIN_PASSWORD=SecurePass123 python seed.py
# 
# SEED_ADMIN_EMAIL=admin@example.com
# SEED_ADMIN_PASSWORD=SecurePass123
# SEED_ADMIN_NAME=System Administrator

# ==================
# Docker Compose Only
# ==================
# These are only used when running with docker-compose.yml
# They configure the PostgreSQL container

# POSTGRES_USER=accounting_user
# POSTGRES_PASSWORD=change_me_in_production
# POSTGRES_DB=accounting_db

# ==================
# Frontend Build Time
# ==================
# API URL for frontend (used at build time by Vite)
# For local development with docker-compose: http://localhost:8000
# For production: https://api.yourdomain.com (e.g., https://api.zzpershub.nl)
# ⚠️ IMPORTANT: This is baked into the frontend at BUILD TIME, not runtime

# VITE_API_URL=http://localhost:8000

# ==================
# PWA Configuration
# ==================
# Enable Progressive Web App features (service worker, offline support, etc.)
# Set to 'true' for production to enable PWA functionality
# VITE_ENABLE_PWA=true

# Enable Background Sync (optional feature, disabled by default)
# Allows queuing of draft operations while offline
# Only safe, non-financial drafts are allowed (draft expenses, draft time entries)
# VITE_PWA_BG_SYNC=false

# Enable Push Notifications (optional feature, disabled by default)
# Allows users to subscribe to browser push notifications
# Requires VAPID keys configured in backend
# VITE_PWA_PUSH=false

# ==========================================
# Tax Submission Connector (Digipoort)
# ==========================================
# Configure tax submission connector for BTW/ICP declarations
# 
# By default, PACKAGE_ONLY mode is used (no network calls)
# To enable Digipoort integration, set DIGIPOORT_ENABLED=true
#
# PACKAGE_ONLY mode (default - safe for production):
# - Stores XML packages locally
# - Returns reference with status=DRAFT
# - Accountant downloads package and submits manually
# - No network calls to external services
#
# DIGIPOORT mode (future - requires Digipoort credentials):
# - Submits directly to Digipoort API
# - Requires valid credentials from Belastingdienst
# - Currently a placeholder skeleton

# Enable Digipoort connector (set to 'true' to enable)
# Default: Not set (uses PACKAGE_ONLY mode)
# DIGIPOORT_ENABLED=false

# Digipoort API endpoint (required if DIGIPOORT_ENABLED=true)
# Production: https://digipoort.belastingdienst.nl/api/v1
# Test: https://test.digipoort.belastingdienst.nl/api/v1
# DIGIPOORT_ENDPOINT=https://test.digipoort.belastingdienst.nl/api/v1

# Digipoort client credentials (required if DIGIPOORT_ENABLED=true)
# Obtain from Belastingdienst portal
# DIGIPOORT_CLIENT_ID=your_client_id
# DIGIPOORT_CLIENT_SECRET=your_client_secret

# Optional: Path to client certificate (if required by Digipoort)
# DIGIPOORT_CERT_PATH=/path/to/client/certificate.pem

# ==========================================
# PKIoverheid Certificate Configuration
# ==========================================
# Configure PKIoverheid certificates for signing VAT submissions
# 
# Certificates and private keys are NEVER stored in the database.
# They must be provided via environment variables or mounted volumes.
#
# Recommended approach for production (Coolify):
# 1. Upload certificate as Coolify secret
# 2. Mount secret as file in container
# 3. Set environment variable to point to mounted path
#
# Example for PKCS#12 (.pfx) certificate:
# PKI_CERT_PATH=/secrets/pki-overheid-cert.pfx
# PKI_CERT_PASSPHRASE=your_secure_passphrase
#
# Example for PEM certificate (cert + key):
# PKI_CERT_PATH=/secrets/pki-overheid-cert.pem
# PKI_KEY_PATH=/secrets/pki-overheid-key.pem
# PKI_CERT_PASSPHRASE=your_secure_passphrase
#
# When registering certificate via API, use these environment variable names:
# - storage_ref: "$PKI_CERT_PATH" or "coolify://pki-cert"
# - passphrase_ref: "$PKI_CERT_PASSPHRASE" or "coolify://pki-passphrase"

# PKI_CERT_PATH=/secrets/pki-overheid-cert.pfx
# PKI_CERT_PASSPHRASE=your_secure_passphrase
